name: Publish page

on:
  push:
    branches:
      - 2.1.3-Alpha

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    env:
      # 配置环境变量，包括镜像的名称，版本号，还有命名空间
      PRO_NAME: alinesno-platform-press
      PRO_VERSION: 2.1.3-Alpha.${{ github.run_number }}
      DOCKER_HUB_NAMESPACE: luoandong
      EXPOSE_PORT: 84
      #  添加cdn配置
      accessKey: ${{ secrets.QINIU_ACCESS_KEY }}
      secretKey: ${{ secrets.QINIU_SECRET_KEY }}
      spaceBucket: acp-document-site
      remoteFolder: /
      domain: http://acp-document.linesno.com
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Use Node.js ${{ matrix.node-version }} 🔧 # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        uses: actions/setup-node@v1
        with:
          node-version: '16.13.1'

      - name: Install Dependencies
        run: npm i

      # 部署到 GitHub Pages
      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }} # 也就是我们刚才生成的 secret
          BRANCH: gh-pages # 部署到 gh-pages 分支，因为 main 分支存放的一般是源码，而 gh-pages 分支则用来存放生成的静态文件
          FOLDER: docs/.vuepress/dist # vuepress 生成的静态文件存放的地方
