name: Publish page

on:
  push:
    branches:
      - 2.1.3-Alpha

jobs:
  build-and-deploy:
    runs-on: self-hosted
    env:
      # é…ç½®çŽ¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬é•œåƒçš„åç§°ï¼Œç‰ˆæœ¬å·ï¼Œè¿˜æœ‰å‘½åç©ºé—´
      PRO_NAME: alinesno-platform-press
      PRO_VERSION: 2.1.3-Alpha.${{ github.run_number }}
      DOCKER_HUB_NAMESPACE: luoandong
      EXPOSE_PORT: 84
      #  æ·»åŠ cdné…ç½®
      accessKey: ${{ secrets.QINIU_ACCESS_KEY }}
      secretKey: ${{ secrets.QINIU_SECRET_KEY }}
      spaceBucket: acp-document-site
      remoteFolder: /
      domain: http://acp-document.linesno.com
    steps:
      - name: Checkout ðŸ›Žï¸
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      - name: Use Node.js ${{ matrix.node-version }} ðŸ”§ # This example project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
        uses: actions/setup-node@v1
        with:
          node-version: '16.13.1'

      - name: Install Dependencies
        run: npm i

      - name: Build Docs
        env:
          NODE_OPTIONS: "--max-old-space-size=8192"
        run: npm run docs:build
 
      # -->>>>>>>>>>>>>>>>>>>>>>>>>>>>>> éƒ¨ç½²åˆ°docker-hub _start >>>>>>>>>>>>>>>>>>>>>>>>>> 
      - name: Build && Push DockerHub
        uses: docker/build-push-action@ad44023a93711e3deb337508980b4b5e9bcdc5dc
        with:
          context: .
          push: false
          tags: ${{ env.DOCKER_HUB_NAMESPACE }}/${{ env.PRO_NAME }}:${{ env.PRO_VERSION }}
          labels: ${{ steps.meta.outputs.labels }}
      # -->>>>>>>>>>>>>>>>>>>>>>>>>>>>>> éƒ¨ç½²åˆ°docker-hub _end >>>>>>>>>>>>>>>>>>>>>>>>>>

      - name: Run Docker script file
      run: |
         chmod +x ./public/scripts/test.sh 
      shell: bash
      # -->>>>>>>>>>>>>>>>>>>>>>>>>>>>>> éƒ¨ç½²åˆ°docker-hub _end >>>>>>>>>>>>>>>>>>>>>>>>>>
