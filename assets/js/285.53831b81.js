(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{659:function(a,s,t){"use strict";t.r(s);var e=t(8),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"容器化集成"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器化集成"}},[a._v("#")]),a._v(" 容器化集成")]),a._v(" "),s("h2",{attrs:{id:"示例工程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#示例工程"}},[a._v("#")]),a._v(" 示例工程")]),a._v(" "),s("p",[a._v("系统应用集成示例工程"),s("a",{attrs:{href:"https://gitee.com/alinesno-cloud/alinesno-demo-gateway-open/tree/master/demo-business-shop",target:"_blank",rel:"noopener noreferrer"}},[a._v("打开"),s("OutboundLink")],1)]),a._v(" "),s("h2",{attrs:{id:"本内容你将获得"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本内容你将获得"}},[a._v("#")]),a._v(" 本内容你将获得")]),a._v(" "),s("ul",[s("li",[a._v("快速集成容器打包的方式和多种打包方式")]),a._v(" "),s("li",[a._v("前后端打包的方式")]),a._v(" "),s("li",[a._v("前端打包自定义后端域名方式")]),a._v(" "),s("li",[a._v("容器上传镜像中心方式")]),a._v(" "),s("li",[a._v("支持源码到镜像（S2I）的集成方式")])]),a._v(" "),s("h2",{attrs:{id:"服务工程容器化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务工程容器化"}},[a._v("#")]),a._v(" 服务工程容器化")]),a._v(" "),s("p",[a._v("这里主要是集成"),s("code",[a._v("jib-maven-plugin")]),a._v("插件，集成的是阿里云镜像仓库")]),a._v(" "),s("h3",{attrs:{id:"配置服务器镜像认证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置服务器镜像认证"}},[a._v("#")]),a._v(" 配置服务器镜像认证")]),a._v(" "),s("p",[a._v("服务器配置 docker-login，如下:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("REGISTRY_USERNAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("REGISTRY_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" login "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$REGISTRY_USERNAME")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$REGISTRY_PASSWORD")]),a._v(" registry.cn-shenzhen.aliyuncs.com\n")])])]),s("h3",{attrs:{id:"容器化打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#容器化打包"}},[a._v("#")]),a._v(" 容器化打包")]),a._v(" "),s("blockquote",[s("p",[a._v("账号名密码可以使用 jenkinsfile 自定义配置，这里做了显示配置，不太安全，例子待补充")])]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 自定义镜像创建和认证")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DOCKER_REGISTRY")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("registry.cn-shenzhen.aliyuncs.com\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("REGISTRY_NAMESPACE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("alinesno-cloud-incubator\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# jenkins写法")]),a._v("\nmvn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-B")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-U")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${projectName}")]),a._v("/pom.xml "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" package\nmvn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-B")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-U")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${projectName}")]),a._v("/pom.xml clean compile jib:build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Ddocker.registry.name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${REGISTRY_NAMESPACE}")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 本地工程写法")]),a._v("\nmvn clean compile jib:build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Ddocker.repostory")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${DOCKER_REGISTRY}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Ddocker.registry.name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${REGISTRY_NAMESPACE}")]),a._v("\n")])])]),s("p",[a._v("如果自定义账号名密码的方式，添加如下配置")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("REGISTRY_USERNAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("REGISTRY_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n\nmvn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-B")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-U")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${projectName}")]),a._v("/pom.xml clean compile jib:build "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Djib.to.auth.username")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${REGISTRY_USERNAME}")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Djib.to.auth.password")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${REGISTRY_PASSWORD}")]),a._v("\n")])])]),s("h2",{attrs:{id:"前端工程容器化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端工程容器化"}},[a._v("#")]),a._v(" 前端工程容器化")]),a._v(" "),s("p",[a._v("这里主要集成的是 maven 打包插件，与 maven 工程整合构建打包")]),a._v(" "),s("h3",{attrs:{id:"前端工程打包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端工程打包"}},[a._v("#")]),a._v(" 前端工程打包")]),a._v(" "),s("p",[a._v("前端工程打成容器镜像")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("projectName")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("alinesno-cloud-demo-ui\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 镜像构建设置变量")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("docker_repostory")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("registry.cn-shenzhen.aliyuncs.com\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("docker_registry_name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("alinesno-cloud-incubator\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("project_artifactid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("alinesno-cloud-demo-ui\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("export")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("project_version")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.1")]),a._v(".2-RC\n\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${projectName}")]),a._v("/docker\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${projectName}")]),a._v("/docker/build-docker.sh\n")])])]),s("p",[a._v("其它"),s("code",[a._v("build-docker.sh")]),a._v("请查看示例工程")]),a._v(" "),s("p",[a._v("2.1.2-RC后版本镜像打包方式，更加简洁，如下:")]),a._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("mvn clean package "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" ./docker/build-docker.sh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v(" registry.cn-shenzhen.aliyuncs.com "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" alinesno-cloud-incubator "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-a")]),a._v(" alinesno-cloud-demo-ui "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2.1")]),a._v(".2-RC\n")])])]),s("p",[a._v("参数说明：")]),a._v(" "),s("ul",[s("li",[a._v("r 镜像仓库地址，比如"),s("code",[a._v("registry.cn-shenzhen.aliyuncs.com")])]),a._v(" "),s("li",[a._v("s 镜像空间地址，比如"),s("code",[a._v("alinesno-cloud")])]),a._v(" "),s("li",[a._v("a 镜像名称，这里建设默认取工程名称或者pom.xml中的articlectid，比如"),s("code",[a._v("alinesno-cloud-demo-s2i-ui")])]),a._v(" "),s("li",[a._v("v 镜像版本号，这里建议跟随工程版本号")])]),a._v(" "),s("h2",{attrs:{id:"其它"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[a._v("#")]),a._v(" 其它")]),a._v(" "),s("ul",[s("li",[a._v("无")])])])}),[],!1,null,null,null);s.default=r.exports}}]);