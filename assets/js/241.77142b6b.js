(window.webpackJsonp=window.webpackJsonp||[]).push([[241],{611:function(a,t,s){"use strict";s.r(t);var n=s(8),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"分布式限流"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分布式限流"}},[a._v("#")]),a._v(" 分布式限流")]),a._v(" "),t("h2",{attrs:{id:"概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),t("p",[a._v("分布式限流使用的，包括接口级别和方法级别的限流，使用 dubbo 默认的限流方式，此限流有一定的代码侵入性，使用场景有限，\n另一个是接口网关的限流，此处使用"),t("code",[a._v("Nginx")]),a._v("网关做外部限流，适用于外部应用限流")]),a._v(" "),t("h2",{attrs:{id:"dubbo-限流说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dubbo-限流说明"}},[a._v("#")]),a._v(" Dubbo 限流说明")]),a._v(" "),t("blockquote",[t("p",[a._v("对编码有侵入性，注意使用场景")])]),a._v(" "),t("p",[a._v("接口限流")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dubbo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("annotation"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Service")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token import"}},[t("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("apache"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("dubbo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("rpc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")])]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Constants")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 限流为5个并发")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Service")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parameters "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Constants")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TPS_LIMIT_RATE_KEY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"5"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ContentCommentsServiceImpl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),a._v(" "),t("h2",{attrs:{id:"nginx-限流使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx-限流使用"}},[a._v("#")]),a._v(" Nginx 限流使用")]),a._v(" "),t("p",[a._v("限流使用系统内部限流机制")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("Syntax: limit_req "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("name "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("burst"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("number"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("nodelay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\nDefault:    —\nContext:    http, server, location\nlimit_req_zone "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$binary_remote_addr")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("one:10m "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("rate")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1r/s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("参数说明:")]),a._v(" "),t("div",{staticClass:"language-properties extra-class"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("第一个参数：$binary_remote_addr")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("表示通过remote_addr这个标识来做限制，“binary_”的目的是缩写内存占用量，是限制同一客户端ip地址。")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("第二个参数：zone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("one:10m表示生成一个大小为10M，名字为one的内存区域，用来存储访问的频次信息。")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("第三个参数：rate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1r/s表示允许相同标识的客户端的访问频次，这里限制的是每秒1次，还可以有比如30r/m的。")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("limit_req")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("zone=one burst=5 nodelay;")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("第一个参数：zone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("one 设置使用哪个配置区域来做限制，与上面limit_req_zone 里的name对应。")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("第二个参数：burst")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("5，重点说明一下这个配置，burst爆发的意思，这个配置的意思是设置一个大小为5的缓冲区当有大量请求（爆发）过来时，超过了访问频次限制的请求可以先放到这个缓冲区内。")]),a._v("\n第三个参数：nodelay，如果设置，超过访问频次而且缓冲区也满了的时候就会直接返回503，如果没有设置，则所有请求会等待排队。\n")])])]),t("p",[a._v("例子：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("http "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    limit_req_zone "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$binary_remote_addr")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("one:10m "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("rate")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("1r/s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    server "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        location /search/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            limit_req "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("zone")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("one "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("burst")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" nodelay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("h2",{attrs:{id:"其它"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[a._v("#")]),a._v(" 其它")]),a._v(" "),t("ul",[t("li",[a._v("略")])])])}),[],!1,null,null,null);t.default=e.exports}}]);