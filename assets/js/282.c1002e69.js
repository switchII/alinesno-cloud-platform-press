(window.webpackJsonp=window.webpackJsonp||[]).push([[282],{656:function(t,a,s){"use strict";s.r(a);var n=s(8),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"自动发布集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动发布集成"}},[t._v("#")]),t._v(" 自动发布集成")]),t._v(" "),a("h2",{attrs:{id:"示例工程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例工程"}},[t._v("#")]),t._v(" 示例工程")]),t._v(" "),a("p",[t._v("系统应用集成示例工程"),a("a",{attrs:{href:"https://gitee.com/alinesno-cloud/alinesno-demo-document/tree/master/demo-deploy",target:"_blank",rel:"noopener noreferrer"}},[t._v("打开"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"本内容你将获得"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本内容你将获得"}},[t._v("#")]),t._v(" 本内容你将获得")]),t._v(" "),a("ul",[a("li",[t._v("自动发布的形式，包含 docker/k8s/jenkinsfile/GithubAction")]),t._v(" "),a("li",[t._v("自动发布使用和针对的场景")]),t._v(" "),a("li",[t._v("多环境配置的切换和配置")]),t._v(" "),a("li",[t._v("应用发布状态检查")]),t._v(" "),a("li",[t._v("发布集成钉钉监控和发布效果")])]),t._v(" "),a("h2",{attrs:{id:"自动化发布的操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自动化发布的操作"}},[t._v("#")]),t._v(" 自动化发布的操作")]),t._v(" "),a("p",[t._v("这里主要是集成自动化的操作，也是 devops 中的一部分，主要是 CICD 整合，达到以下目标:")]),t._v(" "),a("img",{attrs:{src:"/framework/02_person.png"}}),t._v(" "),a("h2",{attrs:{id:"可视化集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可视化集成"}},[t._v("#")]),t._v(" 可视化集成")]),t._v(" "),a("p",[t._v("这里集成jenkins自动生成文件，当中集成包括钉钉通知、链路追踪、日志审计集成、多环境构建、镜像中心等，配置如下：")]),t._v(" "),a("img",{attrs:{src:"/framework/03_jenkins_auto_create.png"}}),t._v(" "),a("p",[t._v("注意点：")]),t._v(" "),a("ul",[a("li",[t._v("这里需要提前配置jenkins相关变量，包括maven配置等，具体"),a("RouterLink",{attrs:{to:"/operation/13_jenkins/01_Jenkins插件安装配置.html"}},[t._v("参考")])],1),t._v(" "),a("li",[t._v("使用阿里云链路跟踪需要提前开通阿里云，一般应用来说是满足的")]),t._v(" "),a("li",[t._v("审计日志服务和链路追踪区别在于日志保留和排查")]),t._v(" "),a("li",[t._v("注意相关插件性能的问题，这个并不是所有都需要集成添加，建议做一下评估")])]),t._v(" "),a("h3",{attrs:{id:"docker-发布方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-发布方式"}},[t._v("#")]),t._v(" docker 发布方式")]),t._v(" "),a("p",[t._v("docker 发布的基础镜像，这部分为默认的基础镜像，包含前端和后台，经过一定的处理")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后台基础镜像")]),t._v("\nregistry.cn-shenzhen.aliyuncs.com/alinesno-base/openjdk11:11.0.9\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 前端基础镜像")]),t._v("\nregistry.cn-shenzhen.aliyuncs.com/alinesno-base/nginx-alpha:1.1.0\n")])])]),a("p",[t._v("注意相关问题：")]),t._v(" "),a("ul",[a("li",[t._v("注意不同的环境可以使用不同的镜像，这里推荐使用最小镜像，具体"),a("RouterLink",{attrs:{to:"/operation/35_container/02_制作和使用.html"}},[t._v("查看")])],1),t._v(" "),a("li",[t._v("nginx 基础镜像已处理 vue 前端出现的 404 问题")]),t._v(" "),a("li",[t._v("后台基础镜像相对较大，此需要注意，包含有一定的调试命令")])]),t._v(" "),a("h3",{attrs:{id:"后台端容器化发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后台端容器化发布"}},[t._v("#")]),t._v(" 后台端容器化发布")]),t._v(" "),a("p",[t._v("通过"),a("code",[t._v("-D")]),t._v("传递相关自定义参数，多种环境切换通过"),a("code",[t._v("application-env.yml")]),t._v("进行切换，运行 docker")]),t._v(" "),a("blockquote",[a("p",[t._v("k8s 请参考示例工程")])]),t._v(" "),a("p",[t._v("运行工程，此处注意不要出现空格")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ALIYUN_CR_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("registry.cn-shenzhen.aliyuncs.com\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ALIYUN_CR_NAMESPACE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("alinesno-cloud-incubator\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PRO_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("alinesno-cloud-base-authority-boot\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PRO_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.1")]),t._v(".2-RC\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EXPOSE_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DOCKER_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PROFILES_ACTIVE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("pro\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_NAME")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ALIYUN_CR_HOST")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ALIYUN_CR_NAMESPACE")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_NAME")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_VERSION")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("JAVA_TOOL_OPTIONS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-Dspring.profiles.active='),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PROFILES_ACTIVE")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$EXPOSE_PORT")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_PORT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_NAME")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"always"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ALIYUN_CR_HOST")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ALIYUN_CR_NAMESPACE")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_NAME")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_VERSION")]),t._v("\n")])])]),a("p",[t._v("后台查询容器运行的情况"),a("code",[t._v("docker ps | grep xxxx")]),t._v("，即可查看监控")]),t._v(" "),a("h3",{attrs:{id:"前端容器化发布和更新脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端容器化发布和更新脚本"}},[t._v("#")]),t._v(" 前端容器化发布和更新脚本")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ALIYUN_CR_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("registry.cn-shenzhen.aliyuncs.com\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ALIYUN_CR_NAMESPACE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("alinesno-cloud-incubator\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PRO_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("alinesno-cloud-demo-ui\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PRO_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.1")]),t._v(".2-RC\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("EXPOSE_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DOCKER_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_NAME")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" pull "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ALIYUN_CR_HOST")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ALIYUN_CR_NAMESPACE")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_NAME")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_VERSION")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$EXPOSE_PORT")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DOCKER_PORT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("API_BASE_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://alinesno-demo.admin.beta.linesno.com"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SERVER_CDN_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://data.linesno.com/alinesno-cloud-demo-ui"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SERVER_STORAGE_UPLOAD_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://alinesno-demo.admin.beta.linesno.com/common/storage/upload"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SERVER_STORAGE_DISPLAY_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://alinesno-demo.admin.beta.linesno.com/common/storage/displayImg/"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_NAME")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"always"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ALIYUN_CR_HOST")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ALIYUN_CR_NAMESPACE")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_NAME")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PRO_VERSION")]),t._v("\n")])])]),a("p",[t._v("后台查询容器运行的情况"),a("code",[t._v("docker ps | grep xxxx")]),t._v("，即可查看监控")]),t._v(" "),a("h3",{attrs:{id:"k8s-发布方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-发布方式"}},[t._v("#")]),t._v(" k8s 发布方式")]),t._v(" "),a("p",[t._v("这里集成的 k8s 配置说明如下，这里只列出主要的配置项，这里推荐一键替换的方式"),a("code",[t._v("alinesno-cloud-shop-manage-boot")]),t._v("，如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" learner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("project\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("revisionHistoryLimit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("strategy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" RollingUpdate\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullSecrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" docker"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("login\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("vpc.cn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shenzhen.aliyuncs.com/alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud/alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("SNAPSHOT\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SPRING_APPLICATION_NAME\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'alinesno-cloud-shop-manage-boot'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SERVER_PORT\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'8080'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 环境变量的配置，这里建议与spring整合")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("livenessProbe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tcpSocket")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("initialDelaySeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("periodSeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeoutSeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("45")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Always\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" learner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("project\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dubbo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("provider\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" TCP\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8180")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8180")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" dev"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alinesno"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("shop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("manage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("boot\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterIP\n")])])]),a("p",[t._v("注意事项：")]),t._v(" "),a("ul",[a("li",[t._v("先在命令配置好 docker-login")]),t._v(" "),a("li",[t._v("镜像的地址是否正确")]),t._v(" "),a("li",[t._v("端口是否正确")]),t._v(" "),a("li",[t._v("这里是"),a("code",[t._v("application-hub.yml")]),t._v("整合的，注意环境变量")])]),t._v(" "),a("h3",{attrs:{id:"githubaction-发布方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#githubaction-发布方式"}},[t._v("#")]),t._v(" GithubAction 发布方式")]),t._v(" "),a("p",[t._v("github action 是一个优秀的，基于开源的自动化构建，相关对部分免费或者个人来说，这不失为一个较好的选择，\n同时插件相当多，稳定性相对较高，当前文档的发布即通过此发布，部分配置如下：")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Build the Docker image\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n    docker version\n    docker login --username=${{ secrets.DOCKER_USERNAME }} --password=${{ secrets.DOCKER_PASSWORD }} registry.cn-shenzhen.aliyuncs.com\n    docker build . --file Dockerfile --tag ${{ env.ALIYUN_CR_HOST }}/${{ env.ALIYUN_CR_NAMESPACE }}/${{ env.PRO_NAME }}:${{ env.PRO_VERSION }}\n    docker push ${{ env.ALIYUN_CR_HOST }}/${{ env.ALIYUN_CR_NAMESPACE }}/${{ env.PRO_NAME }}:${{ env.PRO_VERSION }}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy Docker multiple command\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appleboy/ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.HOST "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.USERNAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.PASSWORD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.PORT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n      docker rm -f ${{ env.PRO_NAME }}\n      docker pull ${{ env.ALIYUN_CR_HOST }}/${{ env.ALIYUN_CR_NAMESPACE }}/${{ env.PRO_NAME }}:${{ env.PRO_VERSION }}\n      docker run -p ${{ env.EXPOSE_PORT }}:80 --name ${{ env.PRO_NAME }} --restart="always" -d ${{ env.ALIYUN_CR_HOST }}/${{ env.ALIYUN_CR_NAMESPACE }}/${{ env.PRO_NAME }}:${{ env.PRO_VERSION }}')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" copy k8s yaml file via ssh password\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appleboy/scp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.K8S_HOST "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.K8S_HOST_USERNAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.K8S_HOST_PASSWORD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.k8S_HOST_PORT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("source")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'k8s-dev.yaml,k8s-dev-ingress.yaml'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'projects/${{ env.PRO_NAME }}'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy Docker to K8S\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" appleboy/ssh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("action@master\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.K8S_HOST "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("username")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.K8S_HOST_USERNAME "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.K8S_HOST_PASSWORD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.k8S_HOST_PORT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n      kubectl version\n      kubectl apply -f projects/${{ env.PRO_NAME }}/k8s-dev.yaml\n      kubectl apply -f projects/${{ env.PRO_NAME }}/k8s-dev-ingress.yaml")]),t._v("\n")])])]),a("p",[t._v("具体可查看配置示例"),a("a",{attrs:{href:"https://gitee.com/alinesno-cloud/alinesno-platform-press/blob/master/.github/workflows/main.yml",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"应用发布状态检测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用发布状态检测"}},[t._v("#")]),t._v(" 应用发布状态检测")]),t._v(" "),a("p",[t._v("应用发布状态检测是确认持续集成发布之后，业务办理是否正常的一个检测，以确保你的自动流程是正确的。\n也可以使用编排工具（比如k8s）和巡检工具，但是相对来说，应用发布自检是在服务发布阶段。")]),t._v(" "),a("p",[t._v("以下为应用发布自检的示例说明，以"),a("code",[t._v("http")]),t._v("检测为例:")]),t._v(" "),a("div",{staticClass:"language-jenkinsfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(' // 服务发布验证，这里采用http验证方式\nstage("等待服务启动") {\n    steps {\n        sleep "${SLEEP_TIME}"\n    }\n}\n\nstage("验证服务状态") {\n    steps {\n        echo "验证服务是状态"\n        script {\n            HTTP_STATUS = sh(script: "curl --insecure -w \'%{http_code}\' ${HOST_URI}:${EXPOSE_PORT} -o /dev/null \\\n                  --header \'Accept: application/json\'", returnStdout: true)\n            echo "验证服务连接返回: ${HTTP_STATUS}"\n        }\n    }\n}\n')])])]),a("p",[t._v("也可以集成tcp/response/数据库/文件等多种形式，这里不做具体的展开阐述，集成业务监控平台的效果:")]),t._v(" "),a("img",{attrs:{src:"/framework/03_jenkins_auto_create_02.png"}}),t._v(" "),a("h2",{attrs:{id:"集成钉钉通知"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集成钉钉通知"}},[t._v("#")]),t._v(" 集成钉钉通知")]),t._v(" "),a("p",[t._v("也可集成邮件通知，这里更加推荐 DingTalk 通知，方便一个入口运维")]),t._v(" "),a("p",[t._v("在 jenkins 中安装"),a("code",[t._v("dingtalk")]),t._v("插件，集成效果如下:")]),t._v(" "),a("img",{staticStyle:{width:"80%"},attrs:{src:"/framework/01_dingtalk_jenkins.png"}}),t._v(" "),a("p",[t._v("这里主要另一个考虑点是基于"),a("code",[t._v("ChatOps")]),t._v("的操作，集成监控自动化一体化")]),t._v(" "),a("h2",{attrs:{id:"其它"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其它"}},[t._v("#")]),t._v(" 其它")]),t._v(" "),a("ul",[a("li",[t._v("无")])])])}),[],!1,null,null,null);a.default=e.exports}}]);